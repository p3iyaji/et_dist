import{u as L,r as f,o as O,b as h,x as z,G as M,c as N,w as j,p as F,e as l,f as r,g as d,h as u,j as s,t as n,l as G,m as c,v as p,F as S,i as V,y as D,z as U,s as I,n as P,k as R}from"./index-BddoOAJV.js";import{s as $}from"./multiselect-i0sJZaV2.js";import{_ as H}from"./AppLayout-CpCNoFib.js";import{u as Q}from"./discountStore-beST0mn1.js";import{S as k}from"./sweetalert2.esm.all-BQIkj5Wb.js";const X={class:"max-w-4xl mx-auto"},Y={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden"},J={class:"p-6"},K={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},W={class:"space-y-6"},Z={key:0,class:"text-red-600"},ee={key:0,class:"text-red-600"},re=["value"],te={key:0,class:"text-red-600"},ae={key:0,class:"text-red-600"},oe={key:0,class:"text-red-600"},se={key:0,class:"text-red-600"},le={key:0,class:"text-red-600"},de={key:0,class:"text-red-600"},ie=["value"],ue={key:0,class:"text-red-600"},ne={key:0,class:"space-y-4 p-4 border border-gray-200 rounded-lg"},ce={class:"flex items-center"},ge={key:0,class:"space-y-2"},pe={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},me={key:1,class:"text-red-600 text-sm"},ye={class:"flex items-center"},be={class:"flex justify-end pt-4"},fe=["disabled"],ke={key:0},xe={key:1,class:"flex items-center"},Ve={__name:"UpdateDiscount",setup(ve){const o=Q(),x=F(),v=z(),y=L(),t=f({name:"",code:"",type:"percentage",value:null,start_date:null,end_date:null,min_quantity:null,min_amount:null,scope:"",usage_limit:null,apply_to_all_products:!0,is_active:!0,product_ids:[]}),b=f([]),_=f(!0),C=[{value:"percentage",label:"Percentage Discount"},{value:"fixed",label:"Fixed Amount Discount"},{value:"buy_x_get_y",label:"Buy X Get Y Offer"}],B=[{value:"general",label:"General"},{value:"product",label:"Product"}];O(async()=>{try{_.value=!0;const g=await h.get("/api/products");b.value=g.data.data.map(m=>({value:m.id.toString(),label:m.name}));const e=v.params.id,a=await h.get(`/api/discounts/${e}`),i=a.data.discount;t.value={name:i.name,code:i.code,type:i.type,value:i.value,start_date:i.start_date?w(i.start_date):null,end_date:i.end_date?w(i.end_date):null,min_quantity:i.min_quantity,min_amount:i.min_amount,usage_limit:i.usage_limit,scope:i.scope,apply_to_all_products:i.apply_to_all_products,is_active:i.is_active,product_ids:a.data.products.map(m=>m.id.toString())},console.log("form.value.product_ids:",t.value.product_ids),console.log("products (Multiselect options):",b.value),M(()=>{t.value.product_ids=[...t.value.product_ids]})}catch(g){console.error("Error loading data:",g),k.fire({icon:"error",title:"Error loading discount",text:g.message})}finally{_.value=!1}});const q=()=>{M(()=>{t.value.product_ids=[...t.value.product_ids]})},w=g=>{const e=new Date(g);return new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,16)},T=()=>t.value.usage_limit!==null&&t.value.usage_limit<=0?(o.errorMessage.usage_limit=["Usage limit must be greater than 0"],!1):!0,E=async()=>{if(!T())return;o.errorMessage={},await o.updateDiscount(v.params.id,t.value)?(k.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,timer:3e3,title:"Discount updated successfully!"}),x.push("/discounts")):o.errorMessage.general&&k.fire({icon:"error",title:"Error",text:o.errorMessage.general[0]})},A=()=>{x.go(-1)};return(g,e)=>(l(),N(H,null,{default:j(()=>[r("div",X,[r("div",Y,[r("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[r("div",{class:"flex justify-between items-center"},[e[12]||(e[12]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Update Category ",-1)),r("button",{onClick:A,type:"button",class:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800"}," Back ")])]),r("div",J,[s(o).errorMessage.general?(l(),d("div",K,n(s(o).errorMessage.general[0]),1)):u("",!0),r("form",{onSubmit:G(E,["prevent"])},[r("div",W,[r("div",null,[e[13]||(e[13]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Discount Name ",-1)),c(r("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.name=a),type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Enter discount name"},null,512),[[p,t.value.name]]),s(o).errorMessage.name?(l(),d("span",Z,n(s(o).errorMessage.name[0]),1)):u("",!0)]),r("div",null,[e[14]||(e[14]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Code ",-1)),c(r("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.code=a),type:"text",id:"code",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Enter discount code"},null,512),[[p,t.value.code]]),s(o).errorMessage.code?(l(),d("span",ee,n(s(o).errorMessage.code[0]),1)):u("",!0)]),r("div",null,[e[15]||(e[15]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Discount Type ",-1)),c(r("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.type=a),id:"type",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},[(l(),d(S,null,V(C,a=>r("option",{key:a.value,value:a.value},n(a.label),9,re)),64))],512),[[D,t.value.type]]),s(o).errorMessage.type?(l(),d("span",te,n(s(o).errorMessage.type[0]),1)):u("",!0)]),r("div",null,[e[16]||(e[16]=r("label",{for:"value",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Value ",-1)),c(r("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.value=a),type:"text",id:"value",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[p,t.value.value]]),s(o).errorMessage.value?(l(),d("span",ae,n(s(o).errorMessage.value[0]),1)):u("",!0)]),r("div",null,[e[17]||(e[17]=r("label",{for:"start_date",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Start Date ",-1)),c(r("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.start_date=a),type:"datetime-local",id:"start_date",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[p,t.value.start_date]]),s(o).errorMessage.start_date?(l(),d("span",oe,n(s(o).errorMessage.start_date[0]),1)):u("",!0)]),r("div",null,[e[18]||(e[18]=r("label",{for:"end_date",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," End Date ",-1)),c(r("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.end_date=a),type:"datetime-local",id:"end_date",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[p,t.value.end_date]]),s(o).errorMessage.end_date?(l(),d("span",se,n(s(o).errorMessage.end_date[0]),1)):u("",!0)]),r("div",null,[e[19]||(e[19]=r("label",{for:"min_quantity",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Min Quantity ",-1)),c(r("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.min_quantity=a),type:"number",id:"min_quantity",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[p,t.value.min_quantity]]),s(o).errorMessage.min_quantity?(l(),d("span",le,n(s(o).errorMessage.min_quantity[0]),1)):u("",!0)]),r("div",null,[e[20]||(e[20]=r("label",{for:"min_amount",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Min Amount ",-1)),c(r("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.min_amount=a),type:"number",id:"min_amount",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[p,t.value.min_amount]]),s(o).errorMessage.min_amount?(l(),d("span",de,n(s(o).errorMessage.min_amount[0]),1)):u("",!0)]),r("div",null,[e[21]||(e[21]=r("label",{class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Discount Scope ",-1)),c(r("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.scope=a),id:"scope",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},[(l(),d(S,null,V(B,a=>r("option",{key:a.value,value:a.value},n(a.label),9,ie)),64))],512),[[D,t.value.scope]]),s(o).errorMessage.scope?(l(),d("span",ue,n(s(o).errorMessage.scope[0]),1)):u("",!0)]),t.value.scope==="product"?(l(),d("div",ne,[r("div",ce,[c(r("input",{"onUpdate:modelValue":e[9]||(e[9]=a=>t.value.apply_to_all_products=a),type:"checkbox",id:"apply_to_all_products",class:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[U,t.value.apply_to_all_products]]),e[22]||(e[22]=r("label",{for:"apply_to_all_products",class:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," Apply to all products ",-1))]),t.value.apply_to_all_products?u("",!0):(l(),d("div",ge,[e[23]||(e[23]=r("label",{class:"block text-sm font-medium text-gray-900 dark:text-white"}," Select Products ",-1)),I(s($),{modelValue:t.value.product_ids,"onUpdate:modelValue":e[10]||(e[10]=a=>t.value.product_ids=a),options:b.value,mode:"tags",closeOnSelect:!1,searchable:!0,placeholder:"Select products",trackBy:"value",label:"label",object:!1,class:"multiselect",onSelect:q},null,8,["modelValue","options"]),t.value.product_ids&&t.value.product_ids.length>0?(l(),d("p",pe," Selected: "+n(t.value.product_ids.length)+" product(s) ",1)):u("",!0),s(o).errorMessage.product_ids?(l(),d("span",me,n(s(o).errorMessage.product_ids[0]),1)):u("",!0)]))])):u("",!0),r("div",ye,[c(r("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.is_active=a),type:"checkbox",id:"is_active",class:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[U,t.value.is_active]]),e[24]||(e[24]=r("label",{for:"is_active",class:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," Active ",-1))]),r("div",be,[r("button",{type:"submit",disabled:s(y).isLoading,class:P(["px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200",{"opacity-50 cursor-not-allowed":s(y).isLoading}])},[s(y).isLoading?(l(),d("span",xe,e[25]||(e[25]=[r("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Updating... ")]))):(l(),d("span",ke,"Update Discount"))],10,fe)])])],32)])])])]),_:1}))}};export{Ve as default};
