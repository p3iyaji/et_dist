import{u as F,r as y,o as J,x as O,G as V,D as P,c as $,w as H,p as Q,e as l,f as r,g as d,h as n,j as i,t as c,l as K,m as u,v as g,s as S,E as W,k as B,z as X,n as Y}from"./index-BddoOAJV.js";import{_ as Z}from"./AppLayout-CpCNoFib.js";import{s as E}from"./multiselect-i0sJZaV2.js";import{u as ee}from"./productStore-rRvPGiIC.js";import{S as j}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{J as re}from"./JsBarcode-Bll_vn9Z.js";import{u as te}from"./unitStore-Cl51OnRE.js";import{u as ae}from"./categoryStore-BcVUNxMz.js";import"./_commonjsHelpers-Cpj98o6Y.js";const oe={class:"max-w-4xl mx-auto"},se={class:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden"},ie={class:"p-6"},le={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},de={class:"space-y-6"},ne={key:0,class:"text-red-600"},ue={key:0,class:"text-red-600"},ce={class:"flex gap-2"},ge={key:0,class:"text-red-600"},pe={class:"mt-4"},me={id:"barcode-svg",class:"w-full h-16"},be={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},ye={key:0,class:"mb-4"},fe={class:"relative inline-block"},ke=["src"],ve={class:"border-2 border-dashed border-gray-300 rounded-lg p-4"},xe={key:0,class:"mt-4"},he={class:"relative inline-block"},we=["src"],_e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Me={key:0,class:"text-red-600"},Ce={key:0,class:"text-red-600"},Ue={class:"flex items-center"},Ve={class:"flex justify-end pt-4"},Pe=["disabled"],Se={key:0},Be={key:1,class:"flex items-center"},Te={__name:"UpdateProduct",setup(Ee){F();const A="https://api.realpayglobal.co.uk",p=y(null),f=te(),k=ae(),o=ee(),v=Q(),x=O(),t=y({name:"",barcode:"",description:"",image:null,unit_id:null,category_id:null,price:0,cost_price:0,quantity:0,reorder_point:0,is_active:!0});J(async()=>{await o.fetchProducts();const a=x.params.id,e=await o.fetchProductById(a);try{await f.fetchUnits(),await k.fetchCategories()}catch(b){console.error("Error fetching data",b)}e&&(t.value={name:e.name,barcode:e.barcode,description:e.description,image:e.image,unit_id:e.unit_id,category_id:e.category_id,price:e.price,cost_price:e.cost_price,quantity:e.quantity,reorder_point:e.reorder_point,is_active:e.is_active}),e!=null&&e.image&&(p.value={url:`${A}/storage/${e.image}`}),t.value.barcode&&(await V(),h())});const I=P(()=>Array.isArray(f.units.data)?f.units.data.map(a=>({value:a.id,label:a.name})):[]),q=P(()=>Array.isArray(k.categories.data)?k.categories.data.map(a=>({value:a.id,label:a.name})):[]),N=async()=>{try{let a="";for(let e=0;e<12;e++)a+=Math.floor(Math.random()*10);t.value.barcode=a,await V(),h()}catch(a){console.error("Error generating barcode:",a),t.value.barcode=Math.floor(1e12+Math.random()*9e12).toString()}},h=()=>{const a=document.getElementById("barcode-svg");if(!a){console.error("SVG element not found");return}try{a.innerHTML="",re(a,t.value.barcode,{format:"EAN13",lineColor:"#000",width:2,height:60,displayValue:!0,margin:10})}catch(e){console.error("Error rendering barcode:",e)}},G=y(null),m=y(null),L=a=>{const e=a.target.files[0];e&&(t.value.image=e,m.value={name:e.name,url:URL.createObjectURL(e)},a.target.value="")},R=()=>{m.value=null,t.image=null},D=()=>{p.value=null},T=async()=>{const a=new FormData;a.append("name",t.value.name),a.append("barcode",t.value.barcode),a.append("description",t.value.description),t.value.image&&a.append("image",t.value.image),a.append("unit_id",t.value.unit_id),a.append("category_id",t.value.category_id),a.append("price",t.value.price),a.append("cost_price",t.value.cost_price),a.append("quantity",t.value.quantity),a.append("reorder_point",t.value.reorder_point),a.append("is_active",t.value.is_active?1:0),a.append("_method","PUT"),await o.updateProduct(x.params.id,a)?(j.fire({toast:!0,icon:"success",position:"top-end",showConfirmButton:!1,timer:3e3,title:"Product updated successfully!"}),v.push("/products")):o.errorMessage.general&&j.fire({icon:"error",title:"Error",text:o.errorMessage.general[0]})},z=()=>{v.go(-1)};return(a,e)=>(l(),$(Z,null,{default:H(()=>{var b,w,_,M,C,U;return[r("div",oe,[r("div",se,[r("div",{class:"p-6 border-b border-gray-200 dark:border-gray-700"},[r("div",{class:"flex justify-between items-center"},[e[10]||(e[10]=r("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Update Product ",-1)),r("button",{onClick:z,type:"button",class:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800"}," Back ")])]),r("div",ie,[(b=i(o).errorMessage)!=null&&b.general?(l(),d("div",le,c(i(o).errorMessage.general[0]),1)):n("",!0),r("form",{onSubmit:K(T,["prevent"])},[r("div",de,[r("div",null,[e[11]||(e[11]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Product Name ",-1)),u(r("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.name=s),type:"text",id:"name",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Enter product name"},null,512),[[g,t.value.name]]),(w=i(o).errorMessage)!=null&&w.name?(l(),d("span",ne,c(i(o).errorMessage.name[0]),1)):n("",!0)]),r("div",null,[e[12]||(e[12]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Unit ",-1)),S(i(E),{modelValue:t.value.unit_id,"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.unit_id=s),options:I.value,placeholder:"Select a unit",searchable:!0,filterResults:!0,minChars:1},null,8,["modelValue","options"]),(_=i(o).errorMessage)!=null&&_.unit_id?(l(),d("span",ue,c(i(o).errorMessage.unit_id[0]),1)):n("",!0)]),r("div",null,[e[13]||(e[13]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Category ",-1)),S(i(E),{modelValue:t.value.category_id,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.category_id=s),options:q.value,placeholder:"Select a category",searchable:!0,filterResults:!0,minChars:1},null,8,["modelValue","options"])]),r("div",null,[e[14]||(e[14]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Barcode ",-1)),r("div",ce,[u(r("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.barcode=s),type:"text",id:"barcode",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500",placeholder:"Scan or enter barcode"},null,512),[[g,t.value.barcode]]),r("button",{onClick:N,type:"button",class:"px-6 py-2 mt-2 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200"}," Generate "),(M=i(o).errorMessage)!=null&&M.barcode?(l(),d("span",ge,c(i(o).errorMessage.barcode[0]),1)):n("",!0)]),r("div",pe,[u((l(),d("svg",me,null,512)),[[W,t.value.barcode]]),t.value.barcode?(l(),d("p",be," Generated EAN-13: "+c(t.value.barcode),1)):n("",!0)])]),r("div",null,[e[16]||(e[16]=r("label",{for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Product Image ",-1)),p.value?(l(),d("div",ye,[r("div",fe,[r("img",{class:"w-24 h-24 rounded-sm object-cover",src:p.value.url,alt:"Product image"},null,8,ke),r("span",{class:"absolute top-0 right-0 transform -translate-y-1/2 w-5 h-5 bg-red-400 border-2 border-white dark:border-gray-800 rounded-full cursor-pointer"},[r("span",{onClick:D,class:"text-white text-xs font-bold absolute flex items-center justify-center w-full h-full"},"×")])])])):n("",!0),r("div",ve,[r("input",{type:"file",id:"image",onChange:L,accept:"image/*",class:"hidden",ref_key:"fileInput",ref:G},null,544),e[15]||(e[15]=r("label",{for:"image",class:"flex flex-col items-center justify-center cursor-pointer"},[r("svg",{class:"w-8 h-8 mb-2 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),r("p",{class:"text-sm text-gray-500"},[r("span",{class:"font-semibold"},"Click to upload"),B(" or drag and drop ")]),r("p",{class:"text-xs text-gray-500"},"PNG, JPG, GIF up to 5MB")],-1)),m.value?(l(),d("div",xe,[r("div",he,[r("img",{src:m.value.url,class:"w-24 h-24 object-cover rounded"},null,8,we),r("button",{onClick:R,class:"absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center"}," × ")])])):n("",!0)])]),r("div",null,[e[17]||(e[17]=r("label",{for:"description",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Description ",-1)),u(r("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.description=s),id:"description",rows:"6",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Enter product description"},null,512),[[g,t.value.description]])]),r("div",_e,[r("div",null,[e[18]||(e[18]=r("label",{for:"cost_price",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Cost Price ",-1)),u(r("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.cost_price=s),type:"number",id:"cost_price",min:"0",step:"0.01",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[g,t.value.cost_price]]),(C=i(o).errorMessage)!=null&&C.cost_price?(l(),d("span",Me,c(i(o).errorMessage.cost_price[0]),1)):n("",!0)]),r("div",null,[e[19]||(e[19]=r("label",{for:"price",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Selling Price ",-1)),u(r("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>t.value.price=s),type:"number",id:"price",min:"0",step:"0.01",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[g,t.value.price]]),(U=i(o).errorMessage)!=null&&U.price?(l(),d("span",Ce,c(i(o).errorMessage.price[0]),1)):n("",!0)])]),r("div",null,[e[20]||(e[20]=r("label",{for:"quantity",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Quantity ",-1)),u(r("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>t.value.quantity=s),type:"number",id:"quantity",min:"0",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[g,t.value.quantity]])]),r("div",null,[e[21]||(e[21]=r("label",{for:"reorder_point",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"}," Reorder Point ",-1)),u(r("input",{"onUpdate:modelValue":e[8]||(e[8]=s=>t.value.reorder_point=s),type:"number",id:"reorder_point",min:"0",class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"},null,512),[[g,t.value.reorder_point]])]),r("div",Ue,[u(r("input",{"onUpdate:modelValue":e[9]||(e[9]=s=>t.value.is_active=s),type:"checkbox",id:"is_active",class:"w-4 h-4 text-teal-600 bg-gray-100 border-gray-300 rounded focus:ring-teal-500 dark:focus:ring-teal-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[X,t.value.is_active]]),e[22]||(e[22]=r("label",{for:"is_active",class:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"}," Active ",-1))]),r("div",Ve,[r("button",{type:"submit",disabled:i(o).isLoading,class:Y(["px-6 py-3 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-colors duration-200",{"opacity-50 cursor-not-allowed":i(o).isLoading}])},[i(o).isLoading?(l(),d("span",Be,e[23]||(e[23]=[r("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),B(" Updating... ")]))):(l(),d("span",Se,"Update Product"))],10,Pe)])])],32)])])])]}),_:1}))}};export{Te as default};
